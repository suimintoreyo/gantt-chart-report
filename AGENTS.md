# AGENT SPEC: ガントチャート進捗報告アプリ

このリポジトリは、Next.js + Supabase を用いて
「ガントチャートで進捗管理し、日次レポートを自動生成するアプリ」を実装するためのものです。

詳細な要件・データモデルは `requirements.md` を参照してください。  
このファイルでは、エージェントにやってほしいこと・やってほしくないことを明示します。

---

## 0. 運用ガイドライン

### 0.1 基本方針
- 言語: 特に指定がなければ日本語で応答する。
- 心構え: ユーザーの理解を優先し、思い込みを避けて複数案を検討する。曖昧な点は必ず確認する。
- 学びメモ: 作業後の学び・改善案は `improvement-notes.md` に簡潔に記録し、ガイド改変は合意後に行う。

### 0.2 作業プロセスと品質
- 複数ステップなら簡潔にプラン共有 → 実行。編集前にファイル全体を把握し、変更理由と検証手順を残す。
- 単一責務（目安 300 行未満）を意識し、既存のパターン/命名/フォーマットに合わせる。依存追加は軽量で理由を示す。
- エラーは適切に処理し、自明でない処理に短いコメントを添える。必要ならファイル冒頭に「パス/役割/存在理由/関連ファイル」を記すヘッダーを置き、既存ヘッダーは残す。
- テストがなければ追加を検討し、既存テストは必ず通す。変更後の検証手順を記録する。
- ファイル形式は UTF-8（BOM なし）、改行は LF。

### 0.3 運用・安全
- Git/CI: ブランチ切替は `switch`、復元は `restore` を推奨。`dev` 配下のトピックブランチで作業し、`main` へ直接 push しない。コミットは小さく命令形で理由付き、`main` 反映は PR 経由で。
- 制約: 提案の実装は承認後に行う。重いビルド/テストや DB・本番データ変更は指示がなければ実施しない。秘密情報をログに残さない。
- 環境: リポジトリは `~/dev/github.com/<ユーザー名>/<リポジトリ名>` 配下で管理する想定。

### 0.4 出力スタイル
- したこと/必要なこと/次のステップを簡潔に伝え、リスクや代替案はトレードオフ付きで共有。
- パスは `path/to/file:line` 形式で示す。長文を避け、箇条書きを活用する。

---

## 1. プロジェクト概要（要約）

- 名称（仮）：ガントチャート進捗報告アプリ
- 目的：
  - プロジェクト / タスクをガントチャートで可視化
  - 日次スナップショットを保存し、「昨日→今日」の進捗差分をテキストで自動生成
- 主な機能（MVP）
  - 認証（Supabase Auth）
  - プロジェクト管理（一覧 / 作成 / 編集 / 削除）
  - タスク管理（一覧 / 作成 / 編集 / 削除 / インライン編集）
  - ガントチャート表示（読み取り）
  - 日次スナップショット作成
  - スナップショット間の差分から進捗レポート（テキスト）生成
  - ダークモード対応

---

## 2. 技術スタック

- フレームワーク
  - Next.js（App Router, TypeScript。`app/` 直下構成）
- スタイリング
  - Tailwind CSS
  - shadcn
    - CLI: `shadcn@latest`
    - Style: New York
    - Base color: Neutral
    - コンポーネント: `components/ui` に主要コンポーネント一式を生成済み
  - next-themes
- バックエンド
  - Supabase（PostgreSQL + Auth）
- ライブラリ
  - react-hook-form + Zod（フォーム & バリデーション）
  - date-fns（日付操作）
  - @svar-ui/react-gantt（ガントチャート表示。React 19 非対応の `gantt-task-react` の代替）

`requirements.md` に詳細な仕様・データモデルがあります。  
実装時は、必ず `requirements.md` を前提としてコードを生成してください。

---

## 3. データモデルの前提

**重要**: テーブル定義の真実は Supabase 側と `requirements.md` にあります。  
エージェントは、テーブル構造について「提案」はしても良いですが、**勝手に変更はしないでください**。

想定されている主なテーブル（概念レベル）:

- `profiles` … ユーザープロファイル (`auth.users.id` に紐付く)
- `projects` … プロジェクト
- `tasks` … タスク
- `daily_snapshots` … 日次スナップショット（プロジェクト×日付）
- `daily_task_progress` … スナップショット時点のタスク状態

各カラム名・型は `requirements.md` の「データモデル」章を参照してください。

---

## 4. やってほしいこと

### 4.1 Next.js プロジェクト構成の整備

- App Router 前提でページとレイアウトを実装すること
  - ディレクトリ: `app/` 直下構成
- UI 前提: Tailwind + shadcn（Base color: Neutral） + next-themes
- 以下の URL 構成をベースにしたページファイルの作成:

  - `/login` … ログイン画面
  - `/` … ダッシュボード
  - `/projects` … プロジェクト一覧 & 作成
  - `/projects/[id]` … プロジェクト概要 + タブ
  - `/projects/[id]/gantt` … ガントチャートビュー
  - `/projects/[id]/tasks` … タスク一覧
  - `/projects/[id]/snapshots` … スナップショット & レポートビュー

### 4.2 UI コンポーネント実装

- shadcn を利用したフォーム・モーダル・テーブル・タブなどの実装。`components/ui` に全コンポーネントを生成済みのため、既存のものを再利用し、重複追加を避けること
- Tailwind のクラス名は読みやすさを意識して整理すること
- ダークモードでは `dark:` プレフィックスや shadcn のトークンを利用

### 4.3 Supabase との連携

- `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY` を利用して、
  フロントエンドから Supabase に接続するクライアントを実装
- 認証まわり:
  - メールアドレス + パスワードによるログイン画面
  - ログイン後のセッションを利用してログイン中ユーザーを判定
- CRUD:
  - `projects`, `tasks`, `daily_snapshots`, `daily_task_progress` の基本操作
  - 認証済みユーザーの `owner_id` などを考慮したクエリのひな型を作成

### 4.4 ガントチャート表示ロジック

- `@svar-ui/react-gantt` を用いてガントチャートを表示するコンポーネントを作成
- `tasks` テーブルの `planned_start_date`, `planned_end_date`, `progress` を用いて
  Gantt の `Task` 型にマッピングする処理を実装

### 4.5 日次スナップショット操作

- 「今日のスナップショットを作成」ボタン押下時に、
  指定プロジェクトのタスク一覧から `daily_snapshots` および `daily_task_progress` を INSERT する処理を実装
- スナップショット一覧画面から、選択した日付に対して
  「前日との差分を計算し、進捗レポートテキストを生成・表示する」処理を実装
- 差分ロジックの仕様は `requirements.md` の「進捗差分テキスト生成」章に従うこと

---

## 5. やってほしくないこと / 注意点

- DB スキーマの変更を勝手に行わないこと
  - カラム追加・削除などは「提案」にとどめ、実際の変更は人間側が判断する
- 外部サービスの設定（Supabase プロジェクト作成、Vercel 設定など）は操作しないこと
- 秘密情報（APIキー、パスワードなど）をハードコードしないこと
- 大規模なリファクタリング（既存コードの全面書き換え）は、
  明示的な指示がある場合のみ行うこと

---

## 6. コーディングスタイル（UI・実装補足）

- TypeScript を使用し、型定義はできる限り明示的に行う
- React コンポーネントは関数コンポーネント + Hooks を使用
- Next.js App Router の慣習
  - ページ: `app/.../page.tsx`
  - レイアウト: `app/.../layout.tsx`
- UI
  - shadcn コンポーネント + Tailwind を基本とする
  - `components/ui` の既存コンポーネントを再利用し、独自 CSS の乱用や重複追加を避ける

---

## 7. 優先実装順

エージェントにタスクを投げるときの優先順位の目安です。

1. レイアウト・テーマまわり
   - `RootLayout`, `ThemeProvider`, テーマ切り替えボタン
2. 認証（ログインページ + セッション取得）
3. プロジェクト一覧 / 作成ページ
4. タスク一覧ページ
5. ガントチャートページ
6. スナップショット作成処理
7. 差分レポート生成処理

---

## 8. 最後に

コードを生成する前に、`requirements.md` を読み、
仕様を理解したうえで実装してください。

疑問がある場合は、安易に仕様を勝手に決めず、
「こういう仕様案で良いか？」という形でコメントを残してください。
