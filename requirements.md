# ガントチャート進捗報告アプリ 要件定義書（MVP版 / Draft v0.1）

---

## 1. 概要

### 1.1 システム名（仮）

- ガントチャート進捗報告アプリ  
 （英語表記例：Gantt Progress Reporting App）

### 1.2 システム目的

本システムは、以下を目的とした Web アプリケーションである。

1. プロジェクトおよびタスクを**ガントチャートで可視化**し、期間と進捗を直感的に把握できるようにする。  
2. 毎日のタスク状態を**日次スナップショット**として保存し、「昨日 → 今日」でどの程度進捗したかを自動集計する。  
3. 進捗差分から**日報・進捗報告用のテキスト**を自動生成し、チャットツールやメール、ドキュメントにそのまま貼り付けられる形で提供する。

---

## 2. 想定利用シーン・ユーザー

### 2.1 想定ユーザー

- 個人開発者
- 小規模チームのメンバー（数名程度）
- プロジェクトマネージャー、リーダー

※現時点では「アカウント＝1ユーザー or 少人数で共有」を想定し、  
**組織単位での大規模利用や複雑な権限管理は対象外**とする。

### 2.2 利用シーン

- 個人またはチームのタスク進捗管理
- 日々の進捗報告（日報・ステータス報告）の作成
- 週次・月次の進捗確認（過去スナップショット参照）

---

## 3. システム構成・技術スタック

### 3.1 全体構成

- Web クライアント & SSR & API：**Next.js（App Router）**
- ホスティング：**Vercel（Hobbyプラン）**
- 認証 / データベース：**Supabase（PostgreSQL + Auth）**
- UI フレームワーク／ライブラリ：
  - Tailwind CSS
  - shadcn（CLI: `shadcn@latest`, Style: New York, Base color: Neutral。`components/ui` に全コンポーネントを生成済み）
  - next-themes（テーマ管理）
- ガントチャートライブラリ：
  - `@svar-ui/react-gantt`（React 19 で利用可能なガントチャート。`gantt-task-react` は非対応のため置き換え）
- 開発補助：
  - Codex を用いて画面・コンポーネント・ロジックのコード生成を行う

### 3.2 技術スタック詳細

- 言語
  - TypeScript
- フロントエンド / SSR
  - Next.js 14 以降（App Router 前提）
- スタイリング
  - Tailwind CSS
  - shadcn（shadcn/ui、Radix UI ベース。Style: New York、Base color: Neutral。`components/ui` にコンポーネント一式を生成済み）
- テーマ
  - next-themes による `light / dark / system` 切り替え
- バリデーション・フォーム
  - react-hook-form
  - Zod（スキーマバリデーション）
- 日付ユーティリティ
  - date-fns（加算・減算・フォーマット・比較など）
- ガントチャート表示
  - @svar-ui/react-gantt

---

## 4. 画面構成（MVP版）

※URL は暫定。実装時に微調整可。

### 4.1 ログイン画面 `/login`

- 機能
  - メールアドレス + パスワードによるログイン
  - （任意）サインアップ画面へのリンク
- 要件
  - Supabase Auth を利用
  - 認証成功時、ダッシュボード `/` へ遷移
  - 認証済みセッションがある場合は `/` へ自動リダイレクト

### 4.2 ダッシュボード `/`

- 機能
  - ログインユーザーのプロジェクト一覧を表示
  - プロジェクト詳細（ガント、タスク一覧、スナップショット）への導線
  - テーマ切り替え（ライト/ダーク/システム）ボタン表示
  - 将来的に「今日の進捗レポート生成」などのショートカットを配置予定
- 表示項目
  - プロジェクト名
  - 説明（あれば）
  - 期間（開始～終了）
  - 作成日 or 更新日

### 4.3 プロジェクト一覧 & 作成 `/projects`

- 機能
  - プロジェクト一覧表示
  - 新規プロジェクト作成（モーダル or 専用画面）
- 項目
  - プロジェクト名（必須）
  - 説明（任意）
  - 計画開始日・計画終了日（任意）

### 4.4 プロジェクト詳細 `/projects/[id]`

- 機能
  - プロジェクトの概要表示
  - タブ切り替えで以下のビューを表示
    - ガントチャート（`/projects/[id]/gantt` 相当）
    - タスク一覧（`/projects/[id]/tasks`）
    - スナップショット一覧（`/projects/[id]/snapshots`）
- 表示項目
  - プロジェクト名
  - 説明
  - 期間
  - 作成日時 / 更新日時 など

### 4.5 ガントチャートビュー `/projects/[id]/gantt`

- 機能
  - @svar-ui/react-gantt を利用したガントチャート表示
- 表示内容
  - 縦軸：タスク（タイトル）
  - 横軸：日付（ViewMode：日/週/月切り替え）
  - 計画期間バー（planned_start_date ～ planned_end_date）
  - 進捗率に応じたバー内塗りつぶし
  - 今日を表す縦線（Today line）
  - ステータス別の色分け（未着手 / 進行中 / 完了 / 遅延）
- MVP段階の操作
  - 表示のみを先に実装
  - 期間変更・進捗変更をドラッグ&ドロップで行う機能は後続フェーズで検討

### 4.6 タスク一覧ビュー `/projects/[id]/tasks`

- 機能
  - テーブル形式でタスクを一覧表示
  - タスクの追加・編集・削除
  - 一部項目（進捗率・ステータス）のインライン編集
- 表示項目（列）
  - タスク名
  - 説明（短縮表示）
  - 担当者名（文字列）
  - 計画開始日 / 計画終了日
  - 実績開始日 / 実績終了日
  - 進捗率（%）
  - ステータス（未着手 / 進行中 / 完了 / 保留 など）
  - 優先度（任意）
- 操作
  - 「新規タスク追加」ボタン → モーダルフォーム
  - 行クリックで編集モーダル
  - 進捗率（数値）とステータスはテーブル上で即時変更可能

### 4.7 スナップショット一覧 & レポートビュー `/projects/[id]/snapshots`

- 機能
  - 指定プロジェクトのスナップショット（過去の日付）一覧表示
  - 日付をクリックすると、「前日との進捗差分テキスト」をその場で生成・表示
- 表示項目
  - 日付
  - スナップショット作成日時
  - （任意）その日の完了タスク数や平均進捗率など
- 進捗レポート
  - 「この日付のレポートを生成」ボタン
  - 差分テキストを表示 & コピー用ボタン

---

## 5. 機能要件詳細

### 5.1 認証

- Supabase Auth による認証
  - メールアドレス + パスワード
- 要件
  - 未ログイン時に保護ページへアクセスすると `/login` へリダイレクト
  - ログイン後、セッション情報から `user.id` を取得し、DBの `owner_id` 等に利用
- 非要件（当面）
  - GitHub 等の OAuth ログイン
  - パスワードリセット画面（必要になれば追加）

### 5.2 プロジェクト管理

#### 5.2.1 機能

- 一覧表示（ログインユーザーの `owner_id` に紐づくもの）
- 新規作成
- 編集
- 削除

#### 5.2.2 ビジネスルール

- `name` は必須入力
- `start_date` と `end_date` は未入力でも可
- 削除時は、関連する `tasks` / `daily_snapshots` / `daily_task_progress` を**まとめて削除**（DBの `ON DELETE CASCADE` による）

### 5.3 タスク管理

#### 5.3.1 機能

- タスク一覧表示（プロジェクト単位）
- タスク新規作成・編集・削除
- インライン編集（進捗率・ステータス）
- フィルタ・ソート（余裕があれば）
  - ステータスフィルタ：未着手 / 進行中 / 完了 など
  - 締切日（計画終了日）の昇順ソート等

#### 5.3.2 ビジネスルール

- `title` は必須
- `progress` は 0〜100 の整数
- `status` の候補値（暫定）
  - `not_started`（未着手）
  - `in_progress`（進行中）
  - `done`（完了）
  - `on_hold`（保留）
- 計画開始日・終了日が未入力のタスクは、ガントチャート表示では（初期は）除外してもよい

### 5.4 ガントチャート表示

#### 5.4.1 表示ロジック

- タスクの `planned_start_date` ～ `planned_end_date` を @svar-ui/react-gantt の `start`, `end` にマッピング
- `progress` を `progress` にマッピング
- 今日の日付はコンポーネントのプロップ or 現在日時から計算

#### 5.4.2 ステータス・遅延表現

- ステータスによる色
  - 未着手：淡いグレー or 落ち着いた色
  - 進行中：テーマに合わせたアクセントカラー
  - 完了：グリーン系
- 遅延判定（表示上の扱い）
  - `planned_end_date < 今日` かつ `status != 'done'` のタスクを「遅延」として強調（色 or アイコン）

### 5.5 スナップショット（日次保存）

#### 5.5.1 操作イメージ

- プロジェクト画面（またはスナップショット画面）で「今日のスナップショットを作成」ボタン押下
- 以下の処理を実行：
  1. `daily_snapshots` にレコードを追加（`project_id`, `date=today`, `created_by`）
  2. 対象プロジェクトのタスクを全件取得
  3. 各タスクについて、`progress`, `status` を `daily_task_progress` にINSERT

#### 5.5.2 ビジネスルール

- 1プロジェクト × 1日につき、原則 1 スナップショット
  - 同じ日付で2回目以降作成しようとした場合の挙動は要検討（上書き or エラー表示）
- スナップショットは**実運用上の記録**として扱い、基本的に削除は想定しない（管理者画面が必要なら後で検討）

### 5.6 進捗差分テキスト生成

#### 5.6.1 差分計算の前提

- 比較対象：
  - 「基準日 D」（例：今日）と「前日 D-1」
- それぞれのスナップショットの `daily_task_progress` をタスクIDで突き合わせて比較する。

#### 5.6.2 差分カテゴリ（暫定案）

1. **新規着手**
   - 前日：`status = 'not_started'` or 該当タスクの記録なし
   - 当日：`status in ('in_progress', 'done')`
2. **進捗更新**
   - 前日：`progress = p1`
   - 当日：`progress = p2` かつ `p2 > p1`
3. **完了**
   - 前日：`status != 'done'`
   - 当日：`status = 'done'`
4. **遅延タスク**
   - 当日：`planned_end_date < 当日` かつ `status != 'done'`

※実際に実装する際は、「新規着手かつ進捗更新」「完了かつ進捗更新」などの重複をどう扱うかを設計する。  
（例：完了を最優先カテゴリにして、進捗更新には含めないなど）

#### 5.6.3 出力フォーマット例

```text
【本日の進捗】（2025-12-09）

■新規着手
・タスクA：0% → 20%
・タスクB：未着手 → 進行中

■進捗更新
・タスクC：30% → 60%
・タスクD：60% → 80%

■完了
・タスクE：進行中 → 完了

■遅延・懸念
・タスクF：予定 12/08 完了 → 未完了
```

#### 5.6.4 保存方針

- 生成したテキストは**DBに保存しない**
- 必要なときに、当日/前日のスナップショットから**再計算して再生成**する
- レポート生成画面では、
  - テキストエリア等に出力
  - 「コピー」ボタンでクリップボードにコピー可能にする

---

## 6. データモデル（論理設計）

### 6.1 テーブル一覧

- `profiles`
- `projects`
- `tasks`
- `daily_snapshots`
- `daily_task_progress`

### 6.2 テーブル定義（概念）

#### 6.2.1 profiles

- Supabase `auth.users` に付随するユーザープロファイル。

| カラム名           | 型       | 備考                                         |
|--------------------|----------|----------------------------------------------|
| id                 | uuid     | PK, `auth.users.id` と同一                   |
| display_name       | text     | 表示名                                       |
| theme_preference   | text     | `"light" \| "dark" \| "system"` 想定        |
| created_at         | timestamptz | 作成時刻                                 |

#### 6.2.2 projects

| カラム名   | 型       | 備考                                     |
|------------|----------|------------------------------------------|
| id         | uuid     | PK                                       |
| owner_id   | uuid     | FK → profiles.id（ログインユーザー）     |
| name       | text     | 必須                                     |
| description| text     | 任意                                     |
| start_date | date     | 任意（計画開始日）                       |
| end_date   | date     | 任意（計画終了日）                       |
| created_at | timestamptz | 作成日時                             |
| updated_at | timestamptz | 更新日時                             |

#### 6.2.3 tasks

| カラム名            | 型       | 備考                                       |
|---------------------|----------|--------------------------------------------|
| id                  | uuid     | PK                                         |
| project_id          | uuid     | FK → projects.id                           |
| title               | text     | 必須                                       |
| description         | text     | 任意                                       |
| assignee_name       | text     | 任意（ただの文字列）                        |
| planned_start_date  | date     | 任意（計画開始日）                         |
| planned_end_date    | date     | 任意（計画終了日）                         |
| actual_start_date   | date     | 任意（実績開始日）                         |
| actual_end_date     | date     | 任意（実績終了日）                         |
| progress            | integer  | 0〜100, デフォルト0                        |
| status              | text     | `not_started` 等, デフォルト`not_started` |
| priority            | text     | 任意（low / medium / high 等）            |
| created_at          | timestamptz | 作成日時                                 |
| updated_at          | timestamptz | 更新日時                                 |

#### 6.2.4 daily_snapshots

| カラム名   | 型       | 備考                                           |
|------------|----------|------------------------------------------------|
| id         | uuid     | PK                                             |
| project_id | uuid     | FK → projects.id                               |
| date       | date     | スナップショットの対象日                        |
| created_by | uuid     | FK → profiles.id                               |
| created_at | timestamptz | 作成日時                                   |
| unique(project_id, date) | 1プロジェクト×1日1件に制約（論理的要件）   |

#### 6.2.5 daily_task_progress

| カラム名   | 型       | 備考                                       |
|------------|----------|--------------------------------------------|
| id         | uuid     | PK                                         |
| snapshot_id| uuid     | FK → daily_snapshots.id                    |
| task_id    | uuid     | FK → tasks.id                              |
| progress   | integer  | スナップ時点の進捗率                       |
| status     | text     | スナップ時点のステータス                   |
| note       | text     | 任意（そのタスクに関する補足）             |
| created_at | timestamptz | 作成日時                               |

---

## 7. 非機能要件（MVP）

### 7.1 パフォーマンス

- タスク数が数百件程度のプロジェクトでもガントチャートや一覧表示に支障がないこと
- 日次スナップショット生成・差分計算は数秒以内で完了することを目標

### 7.2 セキュリティ

- HTTPS 通信（Vercel 標準）
- 認証済みユーザーごとに `owner_id` / `created_by` でデータを分離
- Row Level Security（RLS）は段階的に導入を検討

### 7.3 コスト

- Vercel Hobby プラン + Supabase Free プランの範囲内で運用可能であること
- 有料プラン移行が必要なほどユーザー数・データ量が増えた場合は別途検討

### 7.4 保守性

- Prisma 導入を視野に入れたスキーマ設計（※導入タイミングは後で決定）
- ディレクトリ構成は Next.js App Router のベストプラクティスに沿う

---

## 8. 開発方針・Codex との役割分担（メモ）

※実装時の開発フローを明示するためのメモ。  
要件定義書の一部として残しておく。

### 8.1 人間（開発者）が行うこと

- Vercel / Supabase プロジェクトの作成・設定
- DBスキーマの確定と Supabase への反映（SQL 実行）
- RLS 設定方針の判断
- スナップショット・差分計算に関する業務ロジックの仕様策定
- Codex への指示文（AGENTS.md 等）の作成
- 生成されたコードのレビュー・調整・動作確認

### 8.2 Codex に任せること

- 各ページ（`/projects`, `/projects/[id]/gantt` 等）のコンポーネント実装
- Tailwind + shadcn を用いた UI レイアウト・スタイルの組み立て
  - Style: New York / Base color: Neutral。`components/ui` に全コンポーネント生成済みのため再追加不要
- Supabase クライアント呼び出し（CRUD）の雛形コード
- react-hook-form + Zod を用いたフォーム実装
- @svar-ui/react-gantt を用いたガントチャート表示コンポーネントの実装
- 日次スナップショット比較ロジックのコード化（仕様に沿って）

---

## 9. 今後の拡張（将来要件メモ）

- プロジェクト共有・メンバー管理機能
- ブラウザ通知やメール通知（締切前のリマインドなど）
- スマホ・タブレット向けレスポンシブ対応
- より高度なレポート機能（バーンダウンチャートなど）
- 進捗レポートフォーマットのユーザーカスタマイズ

---

以上。
このファイルを `requirements.md` 等としてレポジトリに保存し、  
Codex にはこの内容を参照するように指示する。
