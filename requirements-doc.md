# ガントチャート進捗管理アプリ 要件書（Codex向け）

## 0. Codex への依頼内容

あなた（Codex）には、以下の要件にもとづき、

* ブラウザ上で動作する **シングルページの進捗管理アプリ** を
* **Vanilla JavaScript + HTML + CSS**（フレームワークなし）で
* GUI操作の快適性を重視して

実装してもらいたい。

最初のアウトプットは、以下3ファイル構成を想定する：

* `index.html`
* `style.css`
* `main.js`

※ ビルドツール不要。`index.html` をブラウザで開けば動く構成にすること。

---

## 1. アプリ概要

### 1.1 目的

* プロジェクト／タスクのスケジュールを **ガントチャート** で可視化する
* 進捗率・作業ログ・一時タスクから、**進捗報告用の文章を自動生成** する
* 突発的な雑務や一時タスクも別枠で記録し、報告文に反映できるようにする
* 何よりも **GUI操作が快適** であること（クリック・ドラッグ・ショートカットなど）

### 1.2 想定環境

* PCブラウザ（最新の Chrome / Edge を想定）
* ローカルファイルとして直接 `index.html` を開いても動作すること
* サーバサイドは使用しない。データはブラウザの **localStorage** に保存

---

## 2. 技術要件

1. **フレームワーク不使用**

   * React / Vue 等は使わず、プレーンな JavaScript, HTML, CSS で実装する
2. **SPA的挙動**

   * 画面全体のリロードなしで、DOM操作により画面を更新する
3. **データ永続化**

   * localStorage を使用して、プロジェクト・タスク・作業ログ・一時タスクを保存／復元する
4. **モジュール構成**

   * `main.js` 内で、役割ごとに関数・オブジェクトを分けて構成する（例：`ProjectStore`, `GanttView`, `TaskTableView` 等）
   * クラスでも関数ベースでもよいが、読みやすさと保守性を重視
5. **コメント**

   * 関数・主要処理には、簡潔なコメント（日本語で可）を付けること
6. **スタイル**

   * `style.css` にスタイルをまとめる
   * ダーク寄りのテーマ（背景は濃いグレー系、文字は白〜淡色）を想定

---

## 3. 画面構成・UI

### 3.1 全体レイアウト

1画面完結構成とし、基本レイアウトは以下：

* **上部ヘッダ**

  * プロジェクト選択ドロップダウン
  * 表示期間（今日／今週／今月）切替
  * 「今日のサマリー」（重要なポイントを簡易表示：今日やるタスク数、遅延タスク数 など）
  * 右上付近に「進捗報告文生成」ボタン

* **中央：左右2ペイン**

  * 左ペイン：タスク一覧テーブル
  * 右ペイン：ガントチャート

* **下部：タブ領域**

  * タブ切替：`作業ログ` | `一時タスク`
  * 選択中タブの内容をテーブル形式で表示

また、画面右側（もしくは右下）に以下を表示する：

* **進捗更新用サイドパネル**

  * タスク選択時、タスクの詳細・進捗スライダー・作業ログ追加フォームを表示

* **右下フローティングボタン**

  * 「＋一時タスク」ボタン
  * クリックで一時タスクの簡易入力モーダル（もしくはサイドパネル）を開く

---

## 4. GUI 操作性 要件

### 4.1 共通操作

* **自動保存**

  * データ変更後、数秒以内に localStorage へ自動保存
  * 画面のどこか（右上など）に「自動保存済み」等の小さなステータス表示

* **ショートカットキー**

  * `Ctrl + S` : 明示的な保存（localStorage へ保存し、「保存しました」トーストを表示）
  * `N` : 新規タスク行にフォーカス
  * `Ctrl + F` : タスク名検索の入力欄にフォーカス
  * `Ctrl + Z / Ctrl + Y` : 直前の操作の Undo / Redo（最低 10〜20 ステップ分）
  * `Ctrl + Enter` : 進捗報告文生成モーダル内で「生成」

* **IME配慮**

  * 日本語入力中の `Enter` でショートカット動作（モーダル閉じる等）が発火しないようにする

### 4.2 タスク一覧テーブル（左ペイン）

**表示**

* 列：

  * チェックボックス（選択用）
  * タスク名
  * 担当者
  * 進捗％
  * 開始日
  * 終了日
  * ステータス（未着手／進行中／完了／保留）
  * 重要度（高／中／低）

* 列ヘッダクリックでソート（昇順／降順トグル）

**操作**

* 行末に常に `+ 新規タスク` 行を表示

  * ここに入力すると新規タスクが作成される
* セル **ダブルクリック** でインライン編集

  * テキスト入力可能なセル（タスク名・担当者・進捗％・日付など）は、セル内で編集
* `Tab` / `Shift + Tab` でセル間移動
* 行選択時、そのタスクをガント上でハイライトし、サイドパネルに詳細表示
* `Delete` キー or 行メニューからタスク削除

**フィルタ**

* 列ヘッダ部に簡易フィルタ（担当者・ステータスなど）

### 4.3 ガントチャート（右ペイン）

**基本表示**

* 縦軸：タスク（タスク一覧と対応）
* 横軸：時間（日単位表示を基本とし、ズームで週／月相当の粗さも切替可能）
* 各タスクはバーとして表示

  * 計画期間：バー全体
  * 進捗率：バー内部の塗りつぶし長さで表現
  * 遅延タスク：バーの色や枠線を変えて視覚的に分かるようにする
* 「今日」を示す縦ラインを表示

**操作**

* **バーのドラッグ移動**

  * 左右ドラッグ：開始日・終了日をそのまま前後にシフト
* **バー端のドラッグ**

  * 両端に小さなハンドルを用意し、ドラッグで開始日／終了日を個別に変更
* **背景ドラッグ**

  * 空白部分ドラッグでガント領域を左右スクロール（パン）
* **ホイール＋Ctrl**

  * 時間軸のズームイン／アウト（簡易でよい。日単位と週単位の2段階でも可）

**新規タスク作成**

* 空白エリアをドラッグで区間を選択 → マウスアップ時に「この範囲で新規タスクを作成」ポップアップ

  * タスク名を入力 → 作成 → タスク一覧にも反映

**コンテキストメニュー**

* タスクバー右クリックでメニュー表示：

  * 「タスク編集」（サイドパネルを開く）
  * 「タスクを複製」
  * 「タスク削除」

### 4.4 サイドパネル（タスク詳細＋進捗更新）

**表示項目**

* タスク名
* 所属プロジェクト
* 担当者
* 計画開始日・終了日
* ステータス
* 進捗スライダー（0〜100%）
* 進捗％直接入力欄
* メモ（任意）
* 「今日の作業ログに追加」用フォーム

  * 作業内容テキスト
  * 所要時間（h）

**操作**

* タスク選択時に右側にスライドイン表示（モバイル対策は不要）
* スライダーで大まかに％を変え、数値入力で微調整
* 「作業ログ追加」ボタンで、現在の日付で WorkLog を追加

### 4.5 下部タブ：作業ログ

**表示**

* 日付
* タスク名
* 作業内容
* 所要時間
* 進捗％（ログ登録時点）

**操作**

* 期間フィルタ：今日／今週／任意期間
* ログ行の編集・削除

### 4.6 下部タブ：一時タスク

**表示**

* 日付
* タイトル
* 詳細メモ
* 所要時間
* 関連プロジェクト（任意）

**操作**

* タブ内で `+` ボタンから追加
* 行のインライン編集
* 削除

**フローティングボタン**

* どの画面からでも右下の「＋一時タスク」ボタンで簡易入力モーダルを開く

  * 日付（デフォルト：今日）
  * タイトル
  * 所要時間
  * メモ
  * 「保存」で一覧に反映

### 4.7 進捗報告文自動生成モーダル

**起動**

* 画面右上の「進捗報告文生成」ボタンでモーダル表示

**モーダル項目**

1. 対象期間

   * ラジオボタン：

     * 「今日」
     * 「今週」
     * 「期間指定」（開始日・終了日入力）
2. 対象プロジェクト

   * プロジェクトのチェックボックスリスト（複数選択可）
3. オプション

   * 「一時タスクも含める」チェックボックス

**生成結果**

* モーダル内の下部にテキストエリアで表示
* 構造（例）：

  * 概要
  * 完了タスク
  * 進行中タスク
  * 遅延タスク（計画との差分から判定）
  * 一時タスク／その他
  * 次回までの予定（簡易でよい：進行中タスク名＋目標）

**操作性**

* 生成後、以下の挙動を実装：

  * テキストエリア内の全選択ボタン
  * 「クリップボードにコピー」ボタン
  * 可能であれば生成直後に自動コピーし、トーストで通知

---

## 5. データモデル仕様

TypeScript 風の型定義で記載する。実装はプレーン JS でよい。

```ts
type ProjectStatus = 'planned' | 'active' | 'completed' | 'on_hold';

interface Project {
  id: string;
  name: string;
  owner?: string;
  startDate: string; // YYYY-MM-DD
  endDate: string;   // YYYY-MM-DD
  status: ProjectStatus;
}

type TaskStatus = 'not_started' | 'in_progress' | 'completed' | 'on_hold';
type TaskPriority = 'high' | 'medium' | 'low';

interface Task {
  id: string;
  projectId: string;
  name: string;
  category?: string;      // フェーズ・カテゴリ
  assignee?: string;
  plannedStart: string;   // YYYY-MM-DD
  plannedEnd: string;     // YYYY-MM-DD
  progress: number;       // 0-100
  status: TaskStatus;
  priority?: TaskPriority;
  dependsOn?: string[];   // 依存タスクID
  notes?: string;
}

interface WorkLog {
  id: string;
  taskId: string;
  date: string;           // YYYY-MM-DD
  workNote: string;
  hours?: number;         // 作業時間（h）
  progressAfter?: number; // ログ登録後の進捗％
}

interface AdhocTask {
  id: string;
  date: string;           // YYYY-MM-DD
  title: string;
  detail?: string;
  hours?: number;
  relatedProjectId?: string;
}

interface AppState {
  projects: Project[];
  tasks: Task[];
  workLogs: WorkLog[];
  adhocTasks: AdhocTask[];
  uiPreferences: {
    taskTableColumnWidths?: { [columnKey: string]: number };
    ganttZoomLevel?: number; // 任意の整数
    theme?: 'dark' | 'light';
  };
}
```

`AppState` 全体を JSON で localStorage に保存／復元する実装とすること。

---

## 6. 機能要件一覧（MVPとして必須）

1. プロジェクトの追加／編集／削除
2. タスクの追加／編集／削除
3. タスク一覧テーブルでのインライン編集・ソート・フィルタ
4. ガントチャート表示

   * バー表示
   * バーのドラッグ移動
   * バー端ドラッグで期間変更
   * Today ライン表示
5. サイドパネルでの進捗更新＆作業ログ登録
6. 一時タスクの管理（追加／編集／削除）
7. 作業ログ一覧表示（下部タブ）
8. 進捗報告文の自動生成モーダル

   * 期間指定
   * プロジェクト指定
   * 一時タスクの取り込み
   * テキスト生成＆コピー
9. localStorage への自動保存・明示保存
10. Undo / Redo（最低限：タスク編集・作成・削除に対応）

---

## 7. 実装アウトプットに関する補足

* レイアウトはレスポンシブでなくてもよい（PC想定）
* CSS はシンプルでよいが、

  * ホバー時のハイライト
  * 選択行／選択タスクの強調
  * エラー時（入力値不正等）の簡易表示
    など、操作時の視覚フィードバックを必ず実装すること。
* ガント描画は、HTML要素（div）＋CSS でも SVG でもよい。
  実装しやすい方を選んでよい。

---

以上を満たす形で、`index.html` / `style.css` / `main.js` を出力してほしい。
必要であれば、最初に **最小機能版（MVP）** を実装し、その後に機能を段階的に追加する形でもよい。
