

## Codex向け依頼文（そのままコピペ用）

以下のリポジトリをベースに、ガントチャートのタスクバーをマウス操作で直接編集できるようにしてください。

* 対象リポジトリ: `https://github.com/suimintoreyo/gantt-chart-report.git`

---

### 0. 依頼内容の概要

現状のガントチャートでは、タスクの開始日・終了日・期間などをフォーム入力などで変更していると思います。
これを **「ガントチャート上のバーをマウス操作で直接編集」できるように改修** してください。

やりたいことは以下の3つです：

1. **バー全体を左右にドラッグ**して、タスクの開始日・終了日をまとめてシフトできる
2. **バー左端をドラッグ**して「開始日」を変更できる
3. **バー右端をドラッグ**して「終了日」を変更できる

いずれの場合も、**バーの見た目だけでなく、内部のデータ（開始日・終了日・期間など）が正しく更新されること** が条件です。

---

### 1. 前提・コード配置について

1. リポジトリをローカルにクローンし、READMEに従って起動してください。
2. ガントチャートを描画している JS ファイル／コンポーネント（例：`main.js` / `gantt.js` / `chart.js` など）を特定し、その中に今回の改修を実装してください。
3. 各タスクバー（DOM要素）には、最低限以下の情報を紐付けてください：

   * 対応するタスクID（`data-task-id` 等）
   * 対応する開始日・終了日の情報（JS側のデータ構造に紐付いていればOK）

※ ファイル名や構造は既存プロジェクトに合わせてください。

---

### 2. マウス操作での編集仕様

#### 2-1. 共通仕様

* マウス操作は **デスクトップブラウザ** を想定（モバイル対応は不要）
* すべての操作は **日単位** でスナップさせること

  * 1日あたりのピクセル幅（例：`dayWidth`）を用意し、
    `移動ピクセル量 / dayWidth` で「何日動かすか」を算出する
* 操作中はバーの位置・長さをリアルタイムで更新し、ドラッグ終了時に確定して内部データへ反映する
* ドラッグ終了後、必要であればフォーム側／他UI側にも新しい日付が反映されるようにする

---

#### 2-2. バー全体のドラッグ（開始＋終了を同時シフト）

**操作方法**

* バーの中央部分（左右端以外）を **マウスダウン → ドラッグ → マウスアップ** で操作
* ドラッグ方向：

  * 右へドラッグ → 開始日・終了日ともに未来側にシフト
  * 左へドラッグ → 開始日・終了日ともに過去側にシフト

**挙動仕様**

* ドラッグ中：

  * バー位置をリアルタイムで移動させる
  * 必要ならツールチップ等で「開始: YYYY-MM-DD / 終了: YYYY-MM-DD」を表示してもよい
* マウスアップ時：

  * `nDays` 日シフトしたと判断したら、

    * `task.startDate` に `+nDays`
    * `task.endDate` に `+nDays`
      を適用
  * 内部データ構造に保存し、再描画を行う
  * 日付を表示しているフォームや一覧があれば、その表示も更新する

**境界条件**

* （あれば）プロジェクト全体の最小日／最大日を超えないようクランプする
* 依存関係がある場合、**依存元より前に行き過ぎない** 等のルールがあるなら、違反しない範囲に制限する
  （依存関係ロジックがなければ、単純なシフトのみで構わない）

---

#### 2-3. 左端ドラッグ（開始日の変更）

**操作方法**

* バーの左端に「リサイズ用ハンドル」を表示し、
  そこを **マウスダウン → 横方向ドラッグ → マウスアップ** で操作

**挙動仕様**

* ドラッグ方向：

  * 左へドラッグ → 開始日を前倒し（期間が長くなる）
  * 右へドラッグ → 開始日を後ろ倒し（期間が短くなる）
* ドラッグ中：

  * バーの左端位置を移動
  * 幅も連動して変更
  * 必要であればツールチップ表示：「開始: YYYY-MM-DD / 期間: N日」など
* マウスアップ時：

  * ピクセル→日数に変換し、`newStartDate` を計算
  * `task.startDate = newStartDate` とし、`task.endDate` は固定
  * 期間（必要であれば日数）を再計算
  * 内部データを更新し、再描画

**制約**

* `startDate` は `endDate` より後ろにならないよう制限する（期間が0日未満にならない）
* 必要であれば「最小期間1日」などの制約を付けてもよい

---

#### 2-4. 右端ドラッグ（終了日の変更）

**操作方法**

* バーの右端に「リサイズ用ハンドル」を用意し、
  **マウスダウン → 横方向ドラッグ → マウスアップ** で操作

**挙動仕様**

* ドラッグ方向：

  * 右へドラッグ → 終了日を後ろ倒し（期間が長くなる）
  * 左へドラッグ → 終了日を前倒し（期間が短くなる）
* ドラッグ中：

  * バーの右端位置を移動
  * 幅を更新
* マウスアップ時：

  * `newEndDate` を算出し、`task.endDate = newEndDate` とする
  * `task.startDate` は固定
  * 期間計算・データ更新・再描画

**制約**

* `endDate` が `startDate` より前にならないようにする
* 必要なら「最大終了日」などの上限を設定してもよい

---

### 3. 実装指針（イベント処理・日付変換）

1. **バーDOMへのイベントバインド**

   * 各バーに対して：

     * `mousedown` (or `pointerdown`) イベントを登録
     * どの領域をクリックしたか（左端／中央／右端）を判定する

       * 例：全体幅の一定割合 or 左右に別ハンドルDOM要素を設ける

2. **ドラッグ中処理**

   * `mousemove` (or `pointermove`) で現在座標を取得
   * `deltaX = currentX - startX`
   * `deltaDays = Math.round(deltaX / dayWidth)` で日数に変換
   * 中央ドラッグの場合：バー全体を `deltaX` 分移動
   * 左端／右端ドラッグの場合：片端だけ移動し、幅を更新

3. **ドラッグ終了処理**

   * `mouseup` (or `pointerup`) でドラッグ終了判定
   * 最終的な `deltaDays` を用いて新しい開始日・終了日を計算
   * 対象タスクのデータ（`task.startDate`, `task.endDate` 等）を更新
   * データストア／状態管理オブジェクトに反映し、ガントチャートを再描画
   * 日付入力フォームやテーブルがある場合はそこにも反映する

4. **日付計算**

   * 日付文字列は `YYYY-MM-DD` を想定
   * JSの `Date` オブジェクトまたは日付ユーティリティ関数で `+deltaDays`／`-deltaDays` を行う
   * タイムゾーン差異が気になる場合は、日付だけ扱う軽量なユーティリティを自前実装してもよい

---

### 4. 反映・保存まわり

* タスクの日付変更後は、既存のロジックに合わせて **保存処理（localStorageなど）にも反映** させてください
* すでに「保存」ボタンや自動保存処理がある場合は、その仕組みを再利用する形で問題ありません

---

### 5. 動作確認用のチェック項目

最終的に、次の項目がすべて満たされていることを確認してください：

1. タスクバーを左右にドラッグすると、開始日・終了日の両方が同じ日数だけシフトする
2. バー左端をドラッグすると、開始日だけが変わる（終了日は固定）
3. バー右端をドラッグすると、終了日だけが変わる（開始日は固定）
4. いずれの場合も、ガントチャートの見た目と内部データ（タスクの開始日・終了日・期間など）が一致している
5. 更新後にページを再読み込みしても、変更後の日付が保持されている（既存の保存仕様に従う）

---

以上の仕様を満たす形で、`gantt-chart-report` リポジトリのコードを改修してください。
実装した主要な関数・イベントハンドラについては、簡潔で構わないのでコメントも付けてください。
